{"remainingRequest":"/home/daniil/Projects/Web/Task11/lesson11/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/daniil/Projects/Web/Task11/lesson11/frontend/src/App.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/daniil/Projects/Web/Task11/lesson11/frontend/src/App.vue","mtime":1608289150302},{"path":"/home/daniil/Projects/Web/Task11/lesson11/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/daniil/Projects/Web/Task11/lesson11/frontend/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/daniil/Projects/Web/Task11/lesson11/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/daniil/Projects/Web/Task11/lesson11/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBIZWFkZXIgZnJvbSAiLi9jb21wb25lbnRzL0hlYWRlciI7CmltcG9ydCBNaWRkbGUgZnJvbSAiLi9jb21wb25lbnRzL01pZGRsZSI7CmltcG9ydCBGb290ZXIgZnJvbSAiLi9jb21wb25lbnRzL0Zvb3RlciI7CmltcG9ydCBheGlvcyBmcm9tICJheGlvcyIKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnQXBwJywKICBjb21wb25lbnRzOiB7CiAgICBGb290ZXIsCiAgICBNaWRkbGUsCiAgICBIZWFkZXIKICB9LAogIGRhdGE6IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB7CiAgICAgIHVzZXI6IG51bGwsCiAgICAgIHVzZXJzOiBbXSwKICAgICAgcG9zdHM6IFtdCiAgICB9CiAgfSwKICBiZWZvcmVNb3VudCgpIHsKICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiand0IikgJiYgIXRoaXMudXNlcikgewogICAgICB0aGlzLiRyb290LiRlbWl0KCJvbkp3dCIsIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJqd3QiKSk7CiAgICB9CgogICAgYXhpb3MuZ2V0KCIvYXBpLzEvdXNlcnMiKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgdGhpcy51c2VycyA9IHJlc3BvbnNlLmRhdGE7CiAgICB9KTsKCiAgICBheGlvcy5nZXQoIi9hcGkvMS9wb3N0cyIpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICB0aGlzLnBvc3RzID0gcmVzcG9uc2UuZGF0YTsKICAgIH0pOwogIH0sCiAgYmVmb3JlQ3JlYXRlKCkgewogICAgdGhpcy4kcm9vdC4kb24oIm9uRW50ZXIiLCAobG9naW4sIHBhc3N3b3JkKSA9PiB7CiAgICAgIC8vIFZhbGlkYXRpb24KICAgICAgLy8gaWYgKHBhc3N3b3JkID09PSAiIikgewogICAgICAvLyAgIHRoaXMuJHJvb3QuJGVtaXQoIm9uRW50ZXJWYWxpZGF0aW9uRXJyb3IiLCAiUGFzc3dvcmQgaXMgcmVxdWlyZWQiKTsKICAgICAgLy8gICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGF4aW9zLnBvc3QoIi9hcGkvMS9qd3QiLCB7CiAgICAgICAgbG9naW4sIHBhc3N3b3JkCiAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJqd3QiLCByZXNwb25zZS5kYXRhKTsKICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJvbkp3dCIsIHJlc3BvbnNlLmRhdGEpOwogICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgdGhpcy4kcm9vdC4kZW1pdCgib25FbnRlclZhbGlkYXRpb25FcnJvciIsIGVycm9yLnJlc3BvbnNlLmRhdGEpOwogICAgICB9KTsKICAgIH0pOwoKICAgIHRoaXMuJHJvb3QuJG9uKCJvblJlZ2lzdGVyIiwgKGxvZ2luLCBuYW1lLCBwYXNzd29yZCkgPT4gewogICAgICAvLyBWYWxpZGF0aW9uCiAgICAgIC8vIGlmIChsb2dpbi5sZW5ndGggPCAzIHx8IGxvZ2luLmxlbmd0aCA+IDE2KSB7CiAgICAgIC8vICAgdGhpcy4kcm9vdC4kZW1pdCgib25SZWdpc3RlclZhbGlkYXRpb25FcnJvciIsICJMb2dpbiBsZW5ndGggc2hvdWxkIGJlIGluIHJhbmdlIGZyb20gMyB0byAxNiBjaGFycyIpOwogICAgICAvLyAgIHJldHVybjsKICAgICAgLy8gfQogICAgICAvLyBpZiAoIS9eW2EtekEtWigpXSskLy50ZXN0KGxvZ2luKSkgewogICAgICAvLyAgIHRoaXMuJHJvb3QuJGVtaXQoIm9uUmVnaXN0ZXJWYWxpZGF0aW9uRXJyb3IiLCAiTG9naW4gc2hvdWxkIGNvbnRhaW4gb25seSBsYXRpbiBjaGFycyIpOwogICAgICAvLyAgIHJldHVybjsKICAgICAgLy8gfQogICAgICAvLyBpZiAobmFtZS5sZW5ndGggPCAxIHx8IG5hbWUubGVuZ3RoID4gMzIpIHsKICAgICAgLy8gICB0aGlzLiRyb290LiRlbWl0KCJvblJlZ2lzdGVyVmFsaWRhdGlvbkVycm9yIiwgIk5hbWUgbGVuZ3RoIHNob3VsZCBiZSBpbiByYW5nZSBmcm9tIDEgdG8gMzIgY2hhcnMiKTsKICAgICAgLy8gICByZXR1cm47CiAgICAgIC8vIH0KICAgICAgLy8gaWYgKHBhc3N3b3JkID09PSAiIikgewogICAgICAvLyAgIHRoaXMuJHJvb3QuJGVtaXQoIm9uUmVnaXN0ZXJWYWxpZGF0aW9uRXJyb3IiLCAiUGFzc3dvcmQgaXMgcmVxdWlyZWQiKTsKICAgICAgLy8gICByZXR1cm47CiAgICAgIC8vIH0KICAgICAgLy8gaWYgKHBhc3N3b3JkLmxlbmd0aCA8IDQgfHwgcGFzc3dvcmQubGVuZ3RoID4gMjApIHsKICAgICAgLy8gICB0aGlzLiRyb290LiRlbWl0KCJvblJlZ2lzdGVyVmFsaWRhdGlvbkVycm9yIiwgIlBhc3N3b3JkIGxlbmd0aCBzaG91bGQgYmUgaW4gcmFuZ2UgZnJvbSA0IHRvIDIwIGNoYXJzIik7CiAgICAgIC8vICAgcmV0dXJuOwogICAgICAvLyB9CgogICAgICBheGlvcy5wb3N0KCIvYXBpLzEvdXNlcnMvcmVnaXN0ZXIiLCB7CiAgICAgICAgbG9naW4sIG5hbWUsIHBhc3N3b3JkCiAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgIGF4aW9zLmdldCgiL2FwaS8xL3VzZXJzIikudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICB0aGlzLnVzZXJzID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJvbkVudGVyIiwgbG9naW4sIHBhc3N3b3JkKTsKICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIm9uUmVnaXN0ZXJWYWxpZGF0aW9uRXJyb3IiLCBlcnJvci5yZXNwb25zZS5kYXRhKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICB0aGlzLiRyb290LiRvbigib25Kd3QiLCAoand0KSA9PiB7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJqd3QiLCBqd3QpOwoKICAgICAgYXhpb3MuZ2V0KCIvYXBpLzEvdXNlcnMvYXV0aCIsIHsKICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgIGp3dAogICAgICAgIH0KICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgdGhpcy51c2VyID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICB0aGlzLiRyb290LiRlbWl0KCJvbkNoYW5nZVBhZ2UiLCAiSW5kZXgiKTsKICAgICAgfSkuY2F0Y2goKCkgPT4gdGhpcy4kcm9vdC4kZW1pdCgib25Mb2dvdXQiKSkKICAgIH0pOwoKICAgIHRoaXMuJHJvb3QuJG9uKCJvbkxvZ291dCIsICgpID0+IHsKICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oImp3dCIpOwogICAgICB0aGlzLnVzZXIgPSBudWxsOwogICAgfSk7CgogICAgdGhpcy4kcm9vdC4kb24oIm9uV3JpdGVQb3N0IiwgKHRpdGxlLCB0ZXh0KSA9PiB7CiAgICAgIGxldCBqd3QgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnand0Jyk7CiAgICAgIGF4aW9zLnBvc3QoIi9hcGkvMS9wb3N0cyIsIHtqd3QsIHRpdGxlLCB0ZXh0fSkKICAgICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgICAgYXhpb3MuZ2V0KCIvYXBpLzEvcG9zdHMiKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICB0aGlzLnBvc3RzID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIm9uQ2hhbmdlUGFnZSIsICJJbmRleCIpOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHRoaXMuJHJvb3QuJGVtaXQoIm9uV3JpdGVQb3N0VmFsaWRhdGlvbkVycm9yIiwgZXJyb3IucmVzcG9uc2UuZGF0YSkpOwogICAgfSkKCiAgICB0aGlzLiRyb290LiRvbigib25Xcml0ZUNvbW1lbnQiLCAocG9zdCwgdGV4dCkgPT4gewogICAgICBsZXQgand0ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2p3dCcpOwogICAgICBheGlvcy5wb3N0KCJhcGkvMS9jb21tZW50cyIsIHtqd3QsIHBvc3QsIHRleHR9KQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIHRoaXMucG9zdHMuZmluZChwID0+IHAuaWQgPT09IHBvc3QuaWQpLmNvbW1lbnRzLnB1c2gocmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIm9uV3JpdGVDb21tZW50QWNjZXB0ZWQiKTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICAgIGlmIChlcnJvci5yZXNwb25zZS5zdGF0dXMgPT09IDUwMCkgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIm9uV3JpdGVDb21tZW50VmFsaWRhdGlvbkVycm9yIiwgIkludGVybmFsIHNlcnZlciBlcnJvciIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuJHJvb3QuJGVtaXQoIm9uV3JpdGVDb21tZW50VmFsaWRhdGlvbkVycm9yIiwgZXJyb3IucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgfSkKICB9Cn0K"},{"version":3,"sources":["App.vue"],"names":[],"mappings":";;;;;;;;;AASA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"App.vue","sourceRoot":"src","sourcesContent":["<template>\n  <div id=\"app\">\n    <Header :user=\"user\"/>\n    <Middle :users=\"users\" :posts=\"posts\"/>\n    <Footer/>\n  </div>\n</template>\n\n<script>\nimport Header from \"./components/Header\";\nimport Middle from \"./components/Middle\";\nimport Footer from \"./components/Footer\";\nimport axios from \"axios\"\n\nexport default {\n  name: 'App',\n  components: {\n    Footer,\n    Middle,\n    Header\n  },\n  data: function () {\n    return {\n      user: null,\n      users: [],\n      posts: []\n    }\n  },\n  beforeMount() {\n    if (localStorage.getItem(\"jwt\") && !this.user) {\n      this.$root.$emit(\"onJwt\", localStorage.getItem(\"jwt\"));\n    }\n\n    axios.get(\"/api/1/users\").then(response => {\n      this.users = response.data;\n    });\n\n    axios.get(\"/api/1/posts\").then(response => {\n      this.posts = response.data;\n    });\n  },\n  beforeCreate() {\n    this.$root.$on(\"onEnter\", (login, password) => {\n      // Validation\n      // if (password === \"\") {\n      //   this.$root.$emit(\"onEnterValidationError\", \"Password is required\");\n      //   return;\n      // }\n\n      axios.post(\"/api/1/jwt\", {\n        login, password\n      }).then(response => {\n        localStorage.setItem(\"jwt\", response.data);\n        this.$root.$emit(\"onJwt\", response.data);\n      }).catch(error => {\n        this.$root.$emit(\"onEnterValidationError\", error.response.data);\n      });\n    });\n\n    this.$root.$on(\"onRegister\", (login, name, password) => {\n      // Validation\n      // if (login.length < 3 || login.length > 16) {\n      //   this.$root.$emit(\"onRegisterValidationError\", \"Login length should be in range from 3 to 16 chars\");\n      //   return;\n      // }\n      // if (!/^[a-zA-Z()]+$/.test(login)) {\n      //   this.$root.$emit(\"onRegisterValidationError\", \"Login should contain only latin chars\");\n      //   return;\n      // }\n      // if (name.length < 1 || name.length > 32) {\n      //   this.$root.$emit(\"onRegisterValidationError\", \"Name length should be in range from 1 to 32 chars\");\n      //   return;\n      // }\n      // if (password === \"\") {\n      //   this.$root.$emit(\"onRegisterValidationError\", \"Password is required\");\n      //   return;\n      // }\n      // if (password.length < 4 || password.length > 20) {\n      //   this.$root.$emit(\"onRegisterValidationError\", \"Password length should be in range from 4 to 20 chars\");\n      //   return;\n      // }\n\n      axios.post(\"/api/1/users/register\", {\n        login, name, password\n      }).then(() => {\n        axios.get(\"/api/1/users\").then(response => {\n          this.users = response.data;\n        });\n        this.$root.$emit(\"onEnter\", login, password);\n      }).catch(error => {\n        this.$root.$emit(\"onRegisterValidationError\", error.response.data);\n      });\n    });\n\n    this.$root.$on(\"onJwt\", (jwt) => {\n      localStorage.setItem(\"jwt\", jwt);\n\n      axios.get(\"/api/1/users/auth\", {\n        params: {\n          jwt\n        }\n      }).then(response => {\n        this.user = response.data;\n        this.$root.$emit(\"onChangePage\", \"Index\");\n      }).catch(() => this.$root.$emit(\"onLogout\"))\n    });\n\n    this.$root.$on(\"onLogout\", () => {\n      localStorage.removeItem(\"jwt\");\n      this.user = null;\n    });\n\n    this.$root.$on(\"onWritePost\", (title, text) => {\n      let jwt = localStorage.getItem('jwt');\n      axios.post(\"/api/1/posts\", {jwt, title, text})\n          .then(() => {\n            axios.get(\"/api/1/posts\").then(response => {\n              this.posts = response.data;\n            });\n            this.$root.$emit(\"onChangePage\", \"Index\");\n          })\n          .catch((error) => this.$root.$emit(\"onWritePostValidationError\", error.response.data));\n    })\n\n    this.$root.$on(\"onWriteComment\", (post, text) => {\n      let jwt = localStorage.getItem('jwt');\n      axios.post(\"api/1/comments\", {jwt, post, text})\n          .then((response) => {\n            this.posts.find(p => p.id === post.id).comments.push(response.data);\n            this.$root.$emit(\"onWriteCommentAccepted\");\n          })\n          .catch((error) => {\n            if (error.response.status === 500) {\n              this.$root.$emit(\"onWriteCommentValidationError\", \"Internal server error\");\n            } else {\n              this.$root.$emit(\"onWriteCommentValidationError\", error.response.data);\n            }\n          });\n    })\n  }\n}\n</script>\n\n<style>\n#app {\n\n}\n</style>\n"]}]}