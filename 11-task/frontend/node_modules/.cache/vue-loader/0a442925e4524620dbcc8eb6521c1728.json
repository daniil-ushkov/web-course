{"remainingRequest":"/home/daniil/Projects/Web/Task11/lesson11/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/daniil/Projects/Web/Task11/lesson11/frontend/src/App.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/home/daniil/Projects/Web/Task11/lesson11/frontend/src/App.vue","mtime":1608289150302},{"path":"/home/daniil/Projects/Web/Task11/lesson11/frontend/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/daniil/Projects/Web/Task11/lesson11/frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/daniil/Projects/Web/Task11/lesson11/frontend/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/daniil/Projects/Web/Task11/lesson11/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/daniil/Projects/Web/Task11/lesson11/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKI2FwcCB7Cgp9Cg=="},{"version":3,"sources":["App.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgJA;;AAEA","file":"App.vue","sourceRoot":"src","sourcesContent":["<template>\n  <div id=\"app\">\n    <Header :user=\"user\"/>\n    <Middle :users=\"users\" :posts=\"posts\"/>\n    <Footer/>\n  </div>\n</template>\n\n<script>\nimport Header from \"./components/Header\";\nimport Middle from \"./components/Middle\";\nimport Footer from \"./components/Footer\";\nimport axios from \"axios\"\n\nexport default {\n  name: 'App',\n  components: {\n    Footer,\n    Middle,\n    Header\n  },\n  data: function () {\n    return {\n      user: null,\n      users: [],\n      posts: []\n    }\n  },\n  beforeMount() {\n    if (localStorage.getItem(\"jwt\") && !this.user) {\n      this.$root.$emit(\"onJwt\", localStorage.getItem(\"jwt\"));\n    }\n\n    axios.get(\"/api/1/users\").then(response => {\n      this.users = response.data;\n    });\n\n    axios.get(\"/api/1/posts\").then(response => {\n      this.posts = response.data;\n    });\n  },\n  beforeCreate() {\n    this.$root.$on(\"onEnter\", (login, password) => {\n      // Validation\n      // if (password === \"\") {\n      //   this.$root.$emit(\"onEnterValidationError\", \"Password is required\");\n      //   return;\n      // }\n\n      axios.post(\"/api/1/jwt\", {\n        login, password\n      }).then(response => {\n        localStorage.setItem(\"jwt\", response.data);\n        this.$root.$emit(\"onJwt\", response.data);\n      }).catch(error => {\n        this.$root.$emit(\"onEnterValidationError\", error.response.data);\n      });\n    });\n\n    this.$root.$on(\"onRegister\", (login, name, password) => {\n      // Validation\n      // if (login.length < 3 || login.length > 16) {\n      //   this.$root.$emit(\"onRegisterValidationError\", \"Login length should be in range from 3 to 16 chars\");\n      //   return;\n      // }\n      // if (!/^[a-zA-Z()]+$/.test(login)) {\n      //   this.$root.$emit(\"onRegisterValidationError\", \"Login should contain only latin chars\");\n      //   return;\n      // }\n      // if (name.length < 1 || name.length > 32) {\n      //   this.$root.$emit(\"onRegisterValidationError\", \"Name length should be in range from 1 to 32 chars\");\n      //   return;\n      // }\n      // if (password === \"\") {\n      //   this.$root.$emit(\"onRegisterValidationError\", \"Password is required\");\n      //   return;\n      // }\n      // if (password.length < 4 || password.length > 20) {\n      //   this.$root.$emit(\"onRegisterValidationError\", \"Password length should be in range from 4 to 20 chars\");\n      //   return;\n      // }\n\n      axios.post(\"/api/1/users/register\", {\n        login, name, password\n      }).then(() => {\n        axios.get(\"/api/1/users\").then(response => {\n          this.users = response.data;\n        });\n        this.$root.$emit(\"onEnter\", login, password);\n      }).catch(error => {\n        this.$root.$emit(\"onRegisterValidationError\", error.response.data);\n      });\n    });\n\n    this.$root.$on(\"onJwt\", (jwt) => {\n      localStorage.setItem(\"jwt\", jwt);\n\n      axios.get(\"/api/1/users/auth\", {\n        params: {\n          jwt\n        }\n      }).then(response => {\n        this.user = response.data;\n        this.$root.$emit(\"onChangePage\", \"Index\");\n      }).catch(() => this.$root.$emit(\"onLogout\"))\n    });\n\n    this.$root.$on(\"onLogout\", () => {\n      localStorage.removeItem(\"jwt\");\n      this.user = null;\n    });\n\n    this.$root.$on(\"onWritePost\", (title, text) => {\n      let jwt = localStorage.getItem('jwt');\n      axios.post(\"/api/1/posts\", {jwt, title, text})\n          .then(() => {\n            axios.get(\"/api/1/posts\").then(response => {\n              this.posts = response.data;\n            });\n            this.$root.$emit(\"onChangePage\", \"Index\");\n          })\n          .catch((error) => this.$root.$emit(\"onWritePostValidationError\", error.response.data));\n    })\n\n    this.$root.$on(\"onWriteComment\", (post, text) => {\n      let jwt = localStorage.getItem('jwt');\n      axios.post(\"api/1/comments\", {jwt, post, text})\n          .then((response) => {\n            this.posts.find(p => p.id === post.id).comments.push(response.data);\n            this.$root.$emit(\"onWriteCommentAccepted\");\n          })\n          .catch((error) => {\n            if (error.response.status === 500) {\n              this.$root.$emit(\"onWriteCommentValidationError\", \"Internal server error\");\n            } else {\n              this.$root.$emit(\"onWriteCommentValidationError\", error.response.data);\n            }\n          });\n    })\n  }\n}\n</script>\n\n<style>\n#app {\n\n}\n</style>\n"]}]}